<script>
        // --- 1. CONFIGURATION DES DATES (Minimum aujourd'hui) ---
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('livraison-date').min = today;
        document.getElementById('restitution-date').min = today;

        // --- 2. GESTION DU FORMULAIRE (ENVOI) ---
        document.getElementById('devisForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // A. Récupération des données
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            // B. Correction des services (checkboxes)
            const services = [];
            document.querySelectorAll('input[name="services"]:checked').forEach(cb => {
                services.push(cb.parentElement.querySelector('.service-text').innerText);
            });
            data.services = services;

            console.log("Envoi des données :", data);

            // C. Envoi au Backend
            try {
               const response = await fetch('/api/v1/users/devis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('✅ Devis envoyé avec succès !');
                    this.reset();
                } else {
                    alert('❌ Erreur serveur lors de l\'envoi.');
                }
            } catch (error) {
                console.error(error);
                alert('❌ Impossible de contacter le serveur (Vérifie qu\'il est lancé sur le port 5000).');
            }
        });

        // --- 3. EFFETS VISUELS (Menu & Scroll) ---
        // (Ce code est maintenant correctement placé EN DEHORS du formulaire)
        
        // Navbar Scroll Effect
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Mobile Menu Toggle
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                document.querySelector('nav ul').classList.toggle('mobile-open');
                menuToggle.classList.toggle('active');
            });
        }
    </script>